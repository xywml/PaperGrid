services:
  app:

    image: ghcr.io/xywml/papergrid:latest
    container_name: papergrid
    ports:
      - "127.0.0.1:6066:3000"
    environment:
      # 建议持久化到数据卷，避免容器重建丢数据
      DATABASE_URL: "file:/data/db.sqlite"
      # 可选：为 AI 向量索引单独使用 SQLite 文件（推荐）
      # AI_VECTOR_DATABASE_URL: "file:/data/ai-index.sqlite"
      # 可选：AI 向量索引使用的 SQLite 日志模式，默认 DELETE（稳定优先）
      # SQLITE_JOURNAL_MODE: "DELETE"
      # 反向代理后必须改成你的公网地址（https://your-domain），否则登录会报 UntrustedHost
      NEXTAUTH_URL: "http://localhost:6066"
      # 仅本地开发可开启（生产环境不要设置）
      AUTH_TRUST_HOST: "1"
      # 可选：启用 /api/init（一次性），必须设置且仅通过请求头 x-init-token 传入
      # INIT_ADMIN_TOKEN: "请替换为随机字符串"
      # 可选：自定义 /api/init 创建的管理员初始密码（不设置则为 admin123）
      # ADMIN_INIT_PASSWORD: "请替换为强密码"
      # SMTP 邮件通知（可选）
      # SMTP_HOST: "smtp.example.com"
      # SMTP_PORT: "465"
      # SMTP_SECURE: "true"
      # SMTP_USER: "noreply@example.com"
      # SMTP_PASS: "your-smtp-password-or-app-token"
      # EMAIL_TO: "owner@example.com,ops@example.com"
      # EMAIL_REPLY_DENYLIST: "deny1@example.com,deny2@example.com"
      # EMAIL_UNSUBSCRIBE_SECRET: "change-this-secret"
      # EMAIL_REPLY_UNSUBSCRIBE_EXPIRE_DAYS: "365"
      NEXT_CACHE_DIR: "/data/.next-cache"
      MEDIA_ROOT: "/data/uploads"
    volumes:
      - papergrid_data:/data
    logging:
      driver: "local"
      options:
        max-size: "10m"
        max-file: "5"
    restart: unless-stopped

volumes:
  papergrid_data:
